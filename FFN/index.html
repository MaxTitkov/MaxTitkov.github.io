
<!DOCTYPE html>
<html class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A short description of my project">
      
      
      
        <meta name="author" content="Max Titkov">
      
      
        <link rel="shortcut icon" href="../assets/images/favicon.ico">
      
      <meta name="generator" content="mkdocs+mkdocs-material#1.0.3">
    
    
      
        <title>Простые нейронные сети - My_Project</title>
      
    
    
      <script src="../assets/javascripts/modernizr-facb31f4a3.js"></script>
    
    
      
        
        
        
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Ubuntu:300,400,400i,700|Ubuntu+Mono">
        <style>body,input{font-family:"Ubuntu","Helvetica Neue",Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Ubuntu Mono","Courier New",Courier,monospace}</style>
      
      <link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons">
    
    
      <link rel="stylesheet" href="../assets/stylesheets/application-bc099a55ca.css">
      
        <link rel="stylesheet" href="../assets/stylesheets/application-02ce7adcc2.palette.css">
      
      
    
    
  </head>
  
  
  
  
    <body data-md-color-primary="red" data-md-color-accent="blue">
  
    <svg class="md-svg">
      <defs>
        
        
      </defs>
    </svg>
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="drawer">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="search">
    <label class="md-overlay" data-md-component="overlay" for="drawer"></label>
    
      <header class="md-header">
  <nav class="md-header-nav md-grid">
    <div class="md-flex">
      <div class="md-flex__cell md-flex__cell--shrink">
        <a href=".." title="My_Project" class=" md-icon md-icon--home  md-header-nav__button">
          
        </a>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        <label class="md-icon md-icon--menu md-header-nav__button" for="drawer"></label>
      </div>
      <div class="md-flex__cell md-flex__cell--stretch">
        <span class="md-flex__ellipsis md-header-nav__title">
          
            
              
            
            Простые нейронные сети
          
        </span>
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
        
          <label class="md-icon md-icon--search md-header-nav__button" for="search"></label>
          
<div class="md-search" data-md-component="search">
  <div class="md-search__overlay"></div>
  <div class="md-search__inner">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" placeholder="Search" accesskey="s" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false">
      <label class="md-icon md-search__icon" for="search"></label>
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="result"></div>
      </div>
    </div>
  </div>
</div>
        
      </div>
      <div class="md-flex__cell md-flex__cell--shrink">
          <div class="md-header-nav__source">
            
          </div>
      </div>
    </div>
  </nav>
</header>
    
    <div class="md-container">
      <main class="md-main">
        <div class="md-main__inner md-grid" data-md-component="container">
          
            
              <div class="md-sidebar md-sidebar--primary" data-md-component="navigation">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    <nav class="md-nav md-nav--primary">
  <label class="md-nav__title md-nav__title--site" for="drawer">
    <i class=" md-icon md-icon--home  md-nav__button">
      
    </i>
    My_Project
  </label>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  <li class="md-nav__item">
    
      <a href=".." title="Home" class="md-nav__link">
        Home
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item">
    
      <a href="../about/" title="About" class="md-nav__link">
        About
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item">
    
    <input class="md-toggle md-nav__toggle" data-md-toggle="toc" type="checkbox" id="toc">
    
      
    
    
    <a href="./" title="Простые нейронные сети" class="md-nav__link md-nav__link--active">
      Простые нейронные сети
    </a>
    
  </li>

    
      
      
  <li class="md-nav__item">
    
      <a href="../CNN/" title="Свёрточные нейронные сети" class="md-nav__link">
        Свёрточные нейронные сети
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item">
    
      <a href="../RNN/" title="Рекуррентные нейронные сети" class="md-nav__link">
        Рекуррентные нейронные сети
      </a>
    
  </li>

    
      
      
  <li class="md-nav__item">
    
      <a href="../Clustering/" title="Обучение без учителя" class="md-nav__link">
        Обучение без учителя
      </a>
    
  </li>

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              <div class="md-sidebar md-sidebar--secondary" data-md-component="toc">
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    
<nav class="md-nav md-nav--secondary">
  
  
  
    <label class="md-nav__title" for="toc">Table of contents</label>
    <ul class="md-nav__list" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#feed-forvard-networksffn" title="Нейронные сети с прямым распространением (feed forvard networks/FFN)" class="md-nav__link">
    Нейронные сети с прямым распространением (feed forvard networks/FFN)
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          <div class="md-content">
            <article class="md-content__inner md-typeset">
               
              
                
                  <h1>Простые нейронные сети</h1>
                
                <h2 id="feed-forvard-networksffn">Нейронные сети с прямым распространением (feed forvard networks/FFN)</h2>
<p>Это самая простая архитектура сетей. В них информация передаётся от входов к выходам. Это базовые сети, которые очень часто входят в состав других сетей. 
Для иллюстрации работы НС с прямып распространением я использую базу данных <a href='https://www.niddk.nih.gov/'>Национального института диабета, заболеваний пищеварительной системы и болезней почек.</a></p>
<p><img alt="Screenshot" src="../img/site-logo-full.png" /></p>
<p>Данные содержат различные измерения в популяции американских индейцев плеимени <a href="https://ru.wikipedia.org/wiki/%D0%9F%D0%B8%D0%BC%D0%B0">Пима</a>, в популяции которых отмается высокая встречаемость диабета.</p>
<p>Это один из типичных наборов данных, на которых тестируют различные алгоритмы машинного обучения.</p>
<pre><code class="python">data = pd.read_csv('https://archive.ics.uci.edu/ml/machine-learning-databases/pima-indians-diabetes/pima-indians-diabetes.data', header=0)
datafr=pd.DataFrame(data)
headers=['NP', 'PGC', 'DBP', 'TSFT', 'Insulin', 'BMass', 'DPF', 'Age', 'class']
datafr.columns=headers
datafr.head()
</code></pre>

<div>
<table border="3" class="dataframe" style="width:100%" >
  <thead>
    <tr >
      <th ></th>
      <th>NP</th>
      <th>PGC</th>
      <th>DBP</th>
      <th>TSFT</th>
      <th>Insulin</th>
      <th>BMass</th>
      <th>DPF</th>
      <th>Age</th>
      <th>class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>85</td>
      <td>66</td>
      <td>29</td>
      <td>0</td>
      <td>26.6</td>
      <td>0.351</td>
      <td>31</td>
      <td>0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>8</td>
      <td>183</td>
      <td>64</td>
      <td>0</td>
      <td>0</td>
      <td>23.3</td>
      <td>0.672</td>
      <td>32</td>
      <td>1</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>89</td>
      <td>66</td>
      <td>23</td>
      <td>94</td>
      <td>28.1</td>
      <td>0.167</td>
      <td>21</td>
      <td>0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>137</td>
      <td>40</td>
      <td>35</td>
      <td>168</td>
      <td>43.1</td>
      <td>2.288</td>
      <td>33</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>116</td>
      <td>74</td>
      <td>0</td>
      <td>0</td>
      <td>25.6</td>
      <td>0.201</td>
      <td>30</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<pre><code class="python">datafr.shape
</code></pre>

<p>(767, 9)</p>
<p>Набор содержит данные 767 человек, здоровых и больных диабетом.
Каждый ряд - это пациент, каждый столбец- какой-либо показатель.</p>
<ol>
<li>NP (Number of times pregnant) - количество беременностей;</li>
<li>PGC (Plasma glucose concentration) - концентрация глюкозы в плазме крови (через 2 часа после глюкозного теста);</li>
<li>DBP (Diastolic blood pressure (mm Hg)) - диастолическое артериальное давление;</li>
<li>TSFT (Triceps skin fold thickness (mm)) - толщина кожной складки;</li>
<li>Insulin (2-Hour serum insulin (mu U/ml)) - уровень инсулина в сыворотке крови;</li>
<li>BMass (Body mass index (weight in kg/(height in m)^2)) - индекс массы тела;</li>
<li>DPF (Diabetes pedigree function) - Индекс встречаемости диабета в семье;</li>
<li>Age (years) - возраст;</li>
<li>Class variable (0 or 1) - переменная класса. Если 1, то у пациента диагностировали диабет. Если 0, то пациент никогда не страдал диабетом.</li>
</ol>
<pre><code class="python">pd.value_counts(datafr['class']).plot(kind='bar', figsize=(2, 3))
plt.title('Healthy/Diabetes', fontsize=8)
</code></pre>

<p><img alt="png" src="../images/output_6_1.png" /></p>
<p>В данном наборе 500 человек здоровые и 267 страдают диабетом</p>
<pre><code class="python">corellation=datafr.corr('pearson')
corellation[-1:]
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: centre;">
      <th></th>
      <th>NP</th>
      <th>PGC</th>
      <th>DBP</th>
      <th>TSFT</th>
      <th>Insulin</th>
      <th>BMass</th>
      <th>DPF</th>
      <th>Age</th>
      <th>class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>class</th>
      <td>0.221087</td>
      <td>0.465856</td>
      <td>0.064882</td>
      <td>0.073265</td>
      <td>0.131984</td>
      <td>0.292695</td>
      <td>0.173245</td>
      <td>0.236417</td>
      <td>1.0</td>
    </tr>
  </tbody>
</table>
</div>

<p>Видно, что линейная связь (<a/ href="http://medstatistic.ru/theory/pirson.html"> корелляция Пирсона</a>) у переменной класса (class) (той, которую нам нужно предсказать) больше 0.3 только в случае PGC-концентрации глюкозы в плазме(0.465856). Это значит, что зависимость между заболеваемостью диабетом и каким-либо ОДНИМ признаком слабая (меньше 0.3). Только в случае с показателем глюкозы в плазме крови она умеренная. 
Ни один из признаков В ОТДЕЛЬНОСТИ не даёт нам возможности судить о том, разовьётся диабет у пациента или нет.</p>
<p>Для того, чтобы предсказать развитие заболевания, нам необходимо каким-то образом обощить все эти признаки.</p>
<p>Собственно, для этого мы построим простую нейронную сеть с прямым распространением.</p>
<p>Схематично её можно изобразить вот так:
<img alt="jpg" src="../images/ffn1.jpg" />
Видно, что сеть имеет 8 входов, соответствующих количеству признаков, 2 скрытых слоя, имеющих 48 и 32 нейрона и один выход. Данные по модели перемещаются только вперёд от входного слоя к выходу. Каждый нейрон одного слоя связан со всеми нейронами последующего слоя синапсами. Во время обучения модели происходит коррекция синапсов и, таким образом, прохождение сигнала изменяется. Наша модель содержит ~2000 синапсов. Выход модели в данном случае будет один, так как мы выбираем только между двумя возможностями: "болен", либо "не болен". Выход в данном случае будет давать только одно число - вероятность болезни. Если вероятность больше 0.5, то сеть считает, что человек болен, если меньше 0.5, то скорее всего здоров. Можно сказать, что если выходной нейрон "возбуждается" сильно, модель считает, что человек болен.</p>
<p>Ниже я подготовил данные для модели, нормализовал их и случайным образом разделил на две выборки: 75% данных уйдёт на обучение модели (X_train и y_train), а 25% данных уйдёт на проверку, насколько хорошо модель справляется со своей задачей (X_test, y_test). То есть, 25%- тестовую выборку модель никогда не "видела" и поэтому, предсказание модели в отношении пациентов из этой выборки будут говорить об эффективности модели.</p>
<pre><code class="python">X_train, X_test, y_train, y_test=train_test_split(X_mstr,y, test_size=0.25, random_state=0)
X_train.shape, X_test.shape, y_train.shape, y_test.shape
</code></pre>

<pre><code>((575L, 8L), (192L, 8L), (575L, 1L), (192L, 1L))
</code></pre>
<p>Теперь я создаю модель искусственной нейронной сети, как на схеме.</p>
<pre><code class="python">model = Sequential()
model.add(Dropout(0.1, input_shape=(8,)))
model.add(Dense(48, init='uniform', activation='relu'))
model.add(Dropout(0.3))
model.add(Dense(32, init='uniform', activation='relu'))
model.add(Dropout(0.3))
model.add(Dense(1, init='uniform', activation='sigmoid'))

sgd=SGD(lr=0.001, momentum=0.2, decay=1e-6, nesterov=1)
model.compile(loss='binary_crossentropy', optimizer=sgd, metrics=['accuracy'])
</code></pre>

<p>Теперь я загружаю данные в модель, указываю некоторые параметры а также, выборку, на основании которой будет производиться проверка способности нашей модели предсказывать.</p>
<pre><code class="python">model.fit(X_train, y_train, 
          validation_data=(X_test, y_test), 
          verbose=2, 
          nb_epoch=5, 
          batch_size=10)
</code></pre>

<pre><code>Train on 575 samples, validate on 192 samples
Epoch 1/5
0s - loss: 0.4962 - acc: 0.7565 - val_loss: 0.4469 - val_acc: 0.8021
Epoch 2/5
0s - loss: 0.5075 - acc: 0.7339 - val_loss: 0.4440 - val_acc: 0.8125
Epoch 3/5
0s - loss: 0.5002 - acc: 0.7409 - val_loss: 0.4401 - val_acc: 0.8021
Epoch 4/5
0s - loss: 0.5106 - acc: 0.7426 - val_loss: 0.4418 - val_acc: 0.7969
Epoch 5/5
0s - loss: 0.4899 - acc: 0.7583 - val_loss: 0.4413 - val_acc: 0.7969
</code></pre>
<p><img alt="png" src="../images/ffn1_output.png" /></p>
<p>Обучение модели осуществляется несколько раз. 
Один цикл обучения называется эпохой. За одну эпоху модель просматривает данные 10 пациентов. Каждый раз, когда в модель поступают данные одного пациента, она делает предсказание. Предсказанное моделью число сравнивается с реальным. Если предсказанное чило ошибочно, ошибка вычисляется и модель корректируется. Затем постуают данные следующего пациента и.т.д.</p>
<p>Вывод вверху я представил с целью иллюстрации. Там всего 5 эпох и ~80% правильных ответов. Я тренировал модель в течение большего количества эпох и с разными параметрами. К 170 эпохе модель достигла точности 82%</p>
<pre><code class="python">model.load_weights('weights_ind/weights-improvement-172-0.82.hdf5')
scores=model.evaluate(X_test, y_test, verbose=0)
print(&quot;%s: %.2f%%&quot; % (model.metrics_names[1], scores[1]*100))
</code></pre>

<pre><code>acc: 82.29%
</code></pre>
<p>Предскажем, будет ли у пациентов диабет и выведем результат для первых 20:</p>
<pre><code class="python">predicted=model.predict_classes(X_test, verbose=0)

pr=pd.DataFrame(np.hstack((y_test, predicted)))
pr.columns=['true', 'predicted']
pr[:20]
</code></pre>

<div>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>true</th>
      <th>predicted</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>3</th>
      <td>1</td>
      <td>0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0</td>
      <td>0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>18</th>
      <td>1</td>
      <td>1</td>
    </tr>
    <tr>
      <th>19</th>
      <td>1</td>
      <td>0</td>
    </tr>
  </tbody>
</table>
</div>

<p>Видим, что многие ответы модели (столбец "predicted") совпадают с реальными ответами.</p>
<p>Итак, мы создали и протестировали модель для предсказания только двух классов. Можно сделать модель для большего числа классов или чисел.</p>
<p>Модели, подобные описанной мною широко применяются во многих отраслях, в т.ч. и медицине.</p>
<p>Например, <a/ href="https://pdfs.semanticscholar.org/7e1a/23188b00c719e656b7949a7c9a1ff2ab841e.pdf">в данной работе</a> рассматриваются FFN для диагностирования развития острого нефрита на основании различных симптомов. <a/ href="https://www.ncbi.nlm.nih.gov/pubmed?linkname=pubmed_pubmed_reviews&from_uid=8818370"> Есть работы и в психиатрии.</a></p>
              
            </article>
          </div>
        </div>
      </main>
      
        
<footer class="md-footer">
  
    <div class="md-footer-nav">
      <nav class="md-footer-nav__inner md-grid">
        
          <a href="../about/" title="About" class="md-flex md-footer-nav__link md-footer-nav__link--prev" rel="prev">
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-back md-footer-nav__button"></i>
            </div>
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Previous
                </span>
                About
              </span>
            </div>
          </a>
        
        
          <a href="../CNN/" title="Свёрточные нейронные сети" class="md-flex md-footer-nav__link md-footer-nav__link--next" rel="next">
            <div class="md-flex__cell md-flex__cell--stretch md-footer-nav__title">
              <span class="md-flex__ellipsis">
                <span class="md-footer-nav__direction">
                  Next
                </span>
                Свёрточные нейронные сети
              </span>
            </div>
            <div class="md-flex__cell md-flex__cell--shrink">
              <i class="md-icon md-icon--arrow-forward md-footer-nav__button"></i>
            </div>
          </a>
        
      </nav>
    </div>
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-footer-copyright">
        
          <div class="md-footer-copyright__highlight">
            Copyright &copy; 2017 Maxim Titkov
          </div>
        
        powered by
        <a href="http://www.mkdocs.org" title="MkDocs">MkDocs</a>
        and
        <a href="http://squidfunk.github.io/mkdocs-material/" title="Material for MkDocs">
          Material for MkDocs</a>
      </div>
      
        
  <div class="md-footer-social">
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    
      <a href="https://www.facebook.com/maxim.max.399041" class="md-footer-social__link fa fa-facebook"></a>
    
  </div>

      
    </div>
  </div>
</footer>
      
    </div>
    
      <script src="../assets/javascripts/application-7f35cda7dd.js"></script>
      <script>var config={url:{base:".."}},app=new Application(config);app.initialize()</script>
      
    
    
      
    
  </body>
</html>